<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ç´«ç…™ãã‚†ã‚‹ç”Ÿç‰©å®¤ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‹å…¨ç”»é¢ï¼‹ã‚«ã‚¹ã‚¿ãƒ å°è©ï¼‰</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root { --bg:#0f0f12; --fg:#e8e8ee; --muted:#9aa0a6; --accent:#bca0ff; --card:#17171b; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP","Yu Gothic UI","Yu Gothic","Meiryo",sans-serif;
            min-height:100dvh; }
  .wrap{display:flex;flex-direction:column;gap:12px;padding:16px;max-width:960px;margin:0 auto; box-sizing:border-box}
  .stage{position:relative;border-radius:16px;background:linear-gradient(180deg,#1a1a22,#0d0d10);min-height:58dvh;
         display:flex;align-items:center;justify-content:center;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05)}
  .char{position:relative;width:min(520px,92vw);aspect-ratio:3/5;background:#111;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden;touch-action:manipulation}
  .layer{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;pointer-events:none}
  .overlay{position:absolute;inset:auto 12px 12px 12px;background:rgba(20,20,26,.7);color:var(--fg);
           border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px;font-size:15px;line-height:1.6;backdrop-filter:blur(6px)}
  .toolbar,.importer,.controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:var(--card);color:var(--fg);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;font-size:14px}
  button:active{transform:translateY(1px)}
  .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .note{color:var(--muted);font-size:12px}
  .panel{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
  input[type=file]{display:none}
  .filelabel{display:inline-block;background:var(--card);border:1px solid rgba(255,255,255,.12);padding:8px 10px;border-radius:10px;font-size:13px}
  textarea{width:100%;min-height:90px;background:var(--card);color:var(--fg);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:8px;font-size:13px;box-sizing:border-box}
  .hidden{display:none}
  .stickyTop{position:sticky; top: env(safe-area-inset-top); z-index:5; background:linear-gradient(180deg,rgba(15,15,18,.9),rgba(15,15,18,.6)); backdrop-filter: blur(6px); padding:8px 12px; border-radius:12px; display:flex; gap:8px; align-items:center; justify-content:space-between; border:1px solid rgba(255,255,255,.08)}
</style>
</head>
<body>
<div class="wrap">
  <div class="stickyTop">
    <div class="controls">
      <button id="btn-fs">å…¨ç”»é¢</button>
      <button id="btn-ui">UIè¡¨ç¤º/éè¡¨ç¤º</button>
    </div>
    <div class="note">ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã§ãƒ–ãƒ©ã‚¦ã‚¶UIãªã—ã®è¡¨ç¤ºãŒå¯èƒ½ã§ã™ï¼ˆiOS/Androidï¼‰</div>
  </div>

  <div class="stage" id="stage">
    <div class="char" id="char" title="ã‚¿ãƒƒãƒ—ã§ã‚»ãƒªãƒ•åˆ‡æ›¿">
      <img id="img-base"  class="layer" alt="base"  />
      <img id="img-coat"  class="layer" alt="coat"  style="display:none"/>
      <img id="img-smile" class="layer" alt="smile" style="display:none"/>
      <img id="img-smoke" class="layer" alt="smoke" style="display:none"/>
    </div>
    <div class="overlay" id="bubble">â€¦â€¦ãŠã‚„ã€æ¥ã¦ãã‚ŒãŸã®ã§ã™ã­ã€‚</div>
  </div>

  <div class="toolbar" id="toolbar">
    <button id="btn-rand">ã‚»ãƒªãƒ•ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</button>
    <button id="btn-greet">æ™‚é–“ã®æŒ¨æ‹¶</button>
    <button id="btn-mood">å¾®ç¬‘ ON/OFF</button>
    <button id="btn-coat">ç™½è¡£ ON/OFF</button>
    <button id="btn-smoke">å–«ç…™ ON/OFF</button>
    <button id="btn-clear">ç”»åƒã‚’ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div class="panel" id="panel-import">
    <div class="row">
      <div>ğŸ–¼ ç”»åƒã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆç«¯æœ«ã‹ã‚‰èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ï¼‰</div>
      <div class="note">ä¸€åº¦èª­ã¿è¾¼ã‚€ã¨ã“ã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
    </div>
    <div class="importer">
      <label class="filelabel" for="file-base">base.png ã‚’é¸ã¶</label><input id="file-base" type="file" accept="image/*">
      <label class="filelabel" for="file-coat">coat.png ã‚’é¸ã¶</label><input id="file-coat" type="file" accept="image/*">
      <label class="filelabel" for="file-smile">smile.png ã‚’é¸ã¶</label><input id="file-smile" type="file" accept="image/*">
      <label class="filelabel" for="file-smoke">smoke.png ã‚’é¸ã¶</label><input id="file-smoke" type="file" accept="image/*">
    </div>
  </div>

  <div class="panel" id="panel-lines">
    <div class="row"><div>âœï¸ ã‚«ã‚¹ã‚¿ãƒ å°è©ï¼ˆè²¼ã‚Šä»˜ã‘â†’ä¿å­˜ï¼‰</div>
      <div class="note">ã‚ãªãŸãŒæ›¸ã„ãŸå°è©ã‚’ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚JSONã§ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã€‚</div></div>
    <div class="note">ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›ã‚‚åæ˜ ã•ã‚Œã¾ã™ã€‚æ—¢å®šã®æ–‡ã¯æ®‹ã—ãŸã¾ã¾è¿½åŠ ã§ã‚‚OKã€‚</div>
    <div class="row"><div>baseLinesï¼ˆé€šå¸¸ï¼‰</div><button id="save-base">ä¿å­˜</button></div>
    <textarea id="ta-base"></textarea>
    <div class="row"><div>coatLinesï¼ˆç™½è¡£æ™‚ã«è¿½åŠ ï¼‰</div><button id="save-coat">ä¿å­˜</button></div>
    <textarea id="ta-coat"></textarea>
    <div class="row"><div>smokeLinesï¼ˆå–«ç…™æ™‚ã«è¿½åŠ ï¼‰</div><button id="save-smoke">ä¿å­˜</button></div>
    <textarea id="ta-smoke"></textarea>
    <div class="row"><div>timeGreetingsï¼ˆæ™‚é–“å¸¯ã”ã¨ã®å€™è£œï¼‰</div><button id="save-time">ä¿å­˜</button></div>
    <textarea id="ta-time"></textarea>
    <div class="row">
      <button id="export-all">å…¨éƒ¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button id="import-all">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
    </div>
    <textarea id="ta-io" placeholder='ã“ã“ã«JSONã‚’è²¼ã‚‹/ã“ã“ã‹ã‚‰ã‚³ãƒ”ãƒ¼'></textarea>
  </div>

  <div class="panel">
    <div class="row"><div>ğŸ” ã‚¯ã‚¤ãƒƒã‚¯è¨ºæ–­</div></div>
    <div class="note" id="diag"></div>
  </div>

</div>
<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const imgBase=$('img-base'), imgCoat=$('img-coat'), imgSmile=$('img-smile'), imgSmoke=$('img-smoke');
  const bubble=$('bubble'), char=$('char');
  const diag=$('diag');

  // ===== State =====
  const state = {
    coat: localStorage.getItem('lover_coat')==='1',
    smoke: (localStorage.getItem('lover_smoke') ?? '') !== '' ? localStorage.getItem('lover_smoke')==='1' : (Math.random()<0.5),
    mood: false
  };

  function sync(){
    imgCoat.style.display = state.coat ? 'block' : 'none';
    imgSmile.style.display = state.mood ? 'block' : 'none';
    imgSmoke.style.display = state.smoke ? 'block' : 'none';
    localStorage.setItem('lover_coat', state.coat ? '1':'0');
    localStorage.setItem('lover_smoke', state.smoke ? '1':'0');
  }
  function setBubble(t){ bubble.textContent=t; }
  function pick(a){ return a[Math.floor(Math.random()*a.length)]; }

  // ===== Default Lines =====
  const defaults = {
    baseLines:[
      "â€¦â€¦ãŠã‚„ã€æ¥ã¦ãã‚ŒãŸã®ã§ã™ã­ã€‚",
      "å¾…ãŸã›ã¦ã—ã¾ã„ã¾ã—ãŸã­ã€‚",
      "é™ã‹ãªå¤œã§ã™ã€‚ã‚ãªãŸã‚‚ã€æ¯ã‚’ã²ã¨ã¤ã€‚",
      "ãµãµã€ãã‚“ãªé¡”ã‚’ã™ã‚‹ã®ã§ã™ã­ã€‚â€¦â€¦å¯æ„›ã‚‰ã—ã„ã€‚",
      "ç›®ã‚’é–‰ã˜ã¦ã€‚â€¦â€¦å¤§ä¸ˆå¤«ã€ã“ã“ã«ã„ã¾ã™ã€‚",
      "èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦ã€‚ã¯ã„ã€ãã†ã€‚å‘¼å¸ãŒæ¥½ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚"
    ],
    coatLines:[
      "ç™½è¡£ã¯ä¾¿åˆ©ã§ã™ã€‚ã‚ãªãŸã‚’æŠ±ãã—ã‚ã‚‹æ™‚ã«ã€çšºã«ãªã‚Šã‚„ã™ã„ã®ãŒé›£ç‚¹ã§ã™ãŒã€‚",
      "è¨ºå¯Ÿã¯ã—ã¾ã›ã‚“ã‚ˆã€‚ãŸã ã€è„ˆã‚’ã¿ã‚‹ãã‚‰ã„ãªã‚‰ã€‚â€¦â€¦ã„ã„ã§ã™ã‹ï¼Ÿ",
      "è„±ãã¹ãã‹ã€ç€ãŸã¾ã¾ãŒè‰¯ã„ã‹â€¦â€¦ã€‚ã‚ãªãŸã«å§”ã­ã¾ã™ã‚ˆã€‚"
    ],
    smokeLines:[
      "â€¦â€¦æ°—ã«éšœã‚Šã¾ã™ã‹ï¼Ÿ ã™ãã«æ¶ˆã—ã¾ã™ã‚ˆã€‚",
      "ä¸€æœ¬ã ã‘ã€‚è€ƒãˆã”ã¨ã‚’ã—ã¦ã„ã‚‹ã¨ã€ã¤ã„ã€‚",
      "ç«ã‚’è¦‹ã‚‹ã¨ã€è½ã¡ç€ãã®ã§ã™ã€‚â€¦â€¦å±ã†ã„ã§ã™ãŒã­ã€‚"
    ],
    timeGreetings:{
      nightLate:[ "ã¾ã èµ·ãã¦ã„ã‚‹ã®ã§ã™ã‹â€¦â€¦ãˆãˆã€å®Ÿã¯ç§ã‚‚ã§ã™ã€‚","å¤œæ›´ã‘ã«å‘¼å¸ã‚’åˆã‚ã›ã‚‹ã¨ã€ä¸æ€è­°ã¨è½ã¡ç€ãã¾ã™ã­ã€‚" ],
      morning:  [ "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚æœã®å…‰ã¯ã€ä½“å†…æ™‚è¨ˆã®è–¬ã§ã™ã€‚","â€¦â€¦ãŠã‚„ã€‚ç¡çœ ä¸è¶³ã§ã™ã‹ï¼Ÿ ç§ã‚‚äººã®ã“ã¨ã‚’è¨€ãˆã¾ã›ã‚“ãŒã­ã€‚" ],
      noon:     [ "ãŠæ˜¼ã¯é£Ÿã¹ã¾ã—ãŸã‹ã€‚çœ ãŸã„ã®ãªã‚‰ã€å°‘ã—ã ã‘é™½ã‚’æµ´ã³ã¦ãã ã•ã„ã€‚","åˆå¾Œã®å…‰ã¯æ°—æ€ ã„ã§ã™ã­â€¦â€¦å°‘ã—è‚©ã®åŠ›ã‚’æŠœãã¾ã—ã‚‡ã†ã€‚" ],
      evening:  [ "ã“ã‚“ã«ã¡ã¯ã€‚è‚©ã«åŠ›ãŒå…¥ã‚Šã™ãã¦ã„ã¾ã›ã‚“ã‹ã€‚","ç©ºã®è‰²ãŒå¤‰ã‚ã‚‹æ™‚é–“â€¦â€¦ã‚ãªãŸã¨è¦‹ã‚‹ã®ãŒå¥½ãã§ã™ã€‚" ],
      night:    [ "ã“ã‚“ã°ã‚“ã¯ã€‚ä»Šæ—¥ã‚‚ã‚ˆãæ¥ã¾ã—ãŸã­ã€‚ä¸€æ¯ã¤ãã¾ã—ã‚‡ã†ã€‚","å®¶ã«å¸°ã£ãŸã‚‰ã€ã‚ãªãŸã¯ã‚‚ã†å®‰å¿ƒã—ã¦ã„ã„ã®ã§ã™ã‚ˆã€‚ç§ãŒã¤ã„ã¦ã„ã¾ã™ã€‚" ]
    }
  };

  // ===== Load/Save Custom Lines =====
  const K = {
    base:'lover_lines_base',
    coat:'lover_lines_coat',
    smoke:'lover_lines_smoke',
    time:'lover_lines_time',
    img:{base:'lover_img_base', coat:'lover_img_coat', smile:'lover_img_smile', smoke:'lover_img_smoke'}
  };

  function getJSON(key, fallback){
    try{
      const v = localStorage.getItem(key);
      if(!v) return JSON.parse(JSON.stringify(fallback));
      const parsed = JSON.parse(v);
      return parsed && typeof parsed === 'object' ? parsed : JSON.parse(JSON.stringify(fallback));
    }catch(e){
      return JSON.parse(JSON.stringify(fallback));
    }
  }

  let baseLines  = getJSON(K.base,  defaults.baseLines);
  let coatLines  = getJSON(K.coat,  defaults.coatLines);
  let smokeLines = getJSON(K.smoke, defaults.smokeLines);
  let timeGreets = getJSON(K.time,  defaults.timeGreetings);

  function saveLines(){
    localStorage.setItem(K.base,  JSON.stringify(baseLines));
    localStorage.setItem(K.coat,  JSON.stringify(coatLines));
    localStorage.setItem(K.smoke, JSON.stringify(smokeLines));
    localStorage.setItem(K.time,  JSON.stringify(timeGreets));
  }

  // ===== UI wiring =====
  const btnRand   = $('btn-rand');
  const btnGreet  = $('btn-greet');
  const btnMood   = $('btn-mood');
  const btnCoat   = $('btn-coat');
  const btnSmoke  = $('btn-smoke');
  const btnClear  = $('btn-clear');
  const btnFS     = $('btn-fs');
  const btnUI     = $('btn-ui');

  const taBase=$('ta-base'), taCoat=$('ta-coat'), taSmoke=$('ta-smoke'), taTime=$('ta-time'), taIO=$('ta-io');
  const saveBase=$('save-base'), saveCoat=$('save-coat'), saveSmoke=$('save-smoke'), saveTime=$('save-time');
  const exportAll=$('export-all'), importAll=$('import-all');

  function timeGreeting(){
    const h = new Date().getHours();
    if (h < 4)  return pick(timeGreets.nightLate || defaults.timeGreetings.nightLate);
    if (h < 11) return pick(timeGreets.morning   || defaults.timeGreetings.morning);
    if (h < 15) return pick(timeGreets.noon      || defaults.timeGreetings.noon);
    if (h < 19) return pick(timeGreets.evening   || defaults.timeGreetings.evening);
    return pick(timeGreets.night                 || defaults.timeGreetings.night);
  }

  function randomLine(){
    let bag=[...baseLines];
    if(state.coat) bag=bag.concat(coatLines);
    if(state.smoke) bag=bag.concat(smokeLines);
    setBubble(pick(bag));
  }

  // tap: only change line (no random mood flip)
  char.addEventListener('click', randomLine);
  btnRand.addEventListener('click', randomLine);
  btnGreet.addEventListener('click', ()=>setBubble(timeGreeting()));
  btnMood.addEventListener('click', ()=>{ state.mood=!state.mood; sync(); setBubble(state.mood?"â€¦â€¦ãã‚“ãªã«è¦‹ã¤ã‚ã‚‰ã‚Œã‚‹ã¨ã€å›°ã‚Šã¾ã™ã‚ˆã€‚":"ã§ã¯ã€å°‘ã—ã ã‘çœŸé¢ç›®ã«ã€‚"); });
  btnCoat.addEventListener('click', ()=>{ state.coat=!state.coat; sync(); setBubble(state.coat?"ç™½è¡£ã€å¥½ãã§ã™ã­ï¼Ÿ":"ã§ã¯ã€ç´ é¡”ã§ã€‚"); });
  btnSmoke.addEventListener('click', ()=>{ state.smoke=!state.smoke; sync(); setBubble(state.smoke?"ä¸€æœ¬ã ã‘ã€‚ã™ãã«æˆ»ã‚Šã¾ã™ã€‚":"ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã‚„ã‚ã¦ãŠãã¾ã—ã‚‡ã†ã€‚"); });
  btnClear.addEventListener('click', ()=>{
    Object.values(K.img).forEach(k=>localStorage.removeItem(k));
    imgBase.removeAttribute('src'); imgCoat.removeAttribute('src'); imgSmile.removeAttribute('src'); imgSmoke.removeAttribute('src');
    setBubble("ç”»åƒã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚å†åº¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚"); updateDiag();
  });

  // Fullscreen + minimal UI
  btnFS.addEventListener('click', async ()=>{
    try{
      if(!document.fullscreenElement){
        await document.documentElement.requestFullscreen();
        if (screen.orientation && screen.orientation.lock) { try{ await screen.orientation.lock('portrait'); }catch(e){} }
      }else{
        await document.exitFullscreen();
      }
    }catch(e){ setBubble("å…¨ç”»é¢ã¯ã“ã®ç’°å¢ƒã§è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ›ãƒ¼ãƒ è¿½åŠ ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚"); }
  });
  btnUI.addEventListener('click', ()=>{
    $('toolbar').classList.toggle('hidden');
    $('panel-import').classList.toggle('hidden');
    $('panel-lines').classList.toggle('hidden');
  });

  // Image persistence via localStorage
  function loadImagesFromStorage(){
    const b=localStorage.getItem(K.img.base);    if(b) imgBase.src=b;
    const c=localStorage.getItem(K.img.coat);    if(c) imgCoat.src=c;
    const s=localStorage.getItem(K.img.smile);   if(s) imgSmile.src=s;
    const k=localStorage.getItem(K.img.smoke);   if(k) imgSmoke.src=k;
  }
  function bindFileInput(id,key,imgEl){
    const input=$(id);
    input.addEventListener('change',()=>{
      const f=input.files && input.files[0]; if(!f) return;
      const reader=new FileReader();
      reader.onload=()=>{
        try{
          const data=reader.result;
          imgEl.src=data;
          localStorage.setItem(key,data);
          setBubble("â€¦â€¦ã¯ã„ã€‚ã“ã‚Œã§ã€ã„ã¤ã§ã‚‚ä¼šãˆã¾ã™ã€‚");
          updateDiag();
        }catch(e){ setBubble("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"); }
      };
      reader.readAsDataURL(f);
    });
  }

  // Diagnostics
  function updateDiag(){
    const kc = localStorage.getItem(K.img.base) ? "âœ…" : "â€”";
    const items = [
      `base: ${imgBase.src ? "èª­ã¿è¾¼ã¿æ¸ˆã¿" : "æœªè¨­å®š"}`,
      `coat: ${imgCoat.src ? "èª­ã¿è¾¼ã¿æ¸ˆã¿" : "æœªè¨­å®š"}`,
      `smile:${imgSmile.src ? "èª­ã¿è¾¼ã¿æ¸ˆã¿" : "æœªè¨­å®š"}`,
      `smoke:${imgSmoke.src ? "èª­ã¿è¾¼ã¿æ¸ˆã¿" : "æœªè¨­å®š"}`,
      `ä¿å­˜: ${kc}ï¼ˆã“ã®ç«¯æœ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰`
    ];
    diag.textContent = items.join(" / ");
  }

  // Lines editor setup
  function refreshEditors(){
    taBase.value  = JSON.stringify(baseLines, null, 2);
    taCoat.value  = JSON.stringify(coatLines, null, 2);
    taSmoke.value = JSON.stringify(smokeLines, null, 2);
    taTime.value  = JSON.stringify(timeGreets, null, 2);
  }
  function safeParse(text, fallback){
    try{ const v = JSON.parse(text); return v; }catch(e){ return fallback; }
  }
  saveBase.addEventListener('click', ()=>{ baseLines = safeParse(taBase.value, baseLines); saveLines(); setBubble("baseLines ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚"); });
  saveCoat.addEventListener('click', ()=>{ coatLines = safeParse(taCoat.value, coatLines); saveLines(); setBubble("coatLines ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚"); });
  saveSmoke.addEventListener('click', ()=>{ smokeLines = safeParse(taSmoke.value, smokeLines); saveLines(); setBubble("smokeLines ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚"); });
  saveTime.addEventListener('click', ()=>{ timeGreets = safeParse(taTime.value, timeGreets); saveLines(); setBubble("timeGreetings ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚"); });

  exportAll.addEventListener('click', ()=>{
    const payload = {
      baseLines, coatLines, smokeLines, timeGreetings: timeGreets
    };
    taIO.value = JSON.stringify(payload, null, 2);
    setBubble("è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ¬„ã«æ›¸ãå‡ºã—ã¾ã—ãŸã€‚");
  });
  importAll.addEventListener('click', ()=>{
    const obj = safeParse(taIO.value, null);
    if(!obj){ setBubble("JSON ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚"); return; }
    if(obj.baseLines)  baseLines  = obj.baseLines;
    if(obj.coatLines)  coatLines  = obj.coatLines;
    if(obj.smokeLines) smokeLines = obj.smokeLines;
    if(obj.timeGreetings) timeGreets = obj.timeGreetings;
    saveLines(); refreshEditors();
    setBubble("è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ä¿å­˜ã—ã¾ã—ãŸã€‚");
  });

  // Init
  bindFileInput('file-base',  K.img.base,  imgBase);
  bindFileInput('file-coat',  K.img.coat,  imgCoat);
  bindFileInput('file-smile', K.img.smile, imgSmile);
  bindFileInput('file-smoke', K.img.smoke, imgSmoke);

  loadImagesFromStorage();
  sync();
  setBubble(localStorage.getItem('lover_first_seen') ? timeGreeting() : "â€¦â€¦ãŠã‚„ã€ã™ã¿ã¾ã›ã‚“ã€‚å¾…ãŸã›ã¦ã—ã¾ã„ã¾ã—ãŸã­ã€‚");
  localStorage.setItem('lover_first_seen','1');
  updateDiag();
  refreshEditors();

  // Tap on char to only change line
  document.getElementById('char').addEventListener('click', randomLine);
  document.getElementById('btn-rand').addEventListener('click', randomLine);
  document.getElementById('btn-greet').addEventListener('click', ()=>setBubble(timeGreeting()));
  document.getElementById('btn-mood').addEventListener('click', ()=>{ state.mood=!state.mood; sync(); setBubble(state.mood?"â€¦â€¦ãã‚“ãªã«è¦‹ã¤ã‚ã‚‰ã‚Œã‚‹ã¨ã€å›°ã‚Šã¾ã™ã‚ˆã€‚":"ã§ã¯ã€å°‘ã—ã ã‘çœŸé¢ç›®ã«ã€‚"); });
  document.getElementById('btn-coat').addEventListener('click', ()=>{ state.coat=!state.coat; sync(); setBubble(state.coat?"ç™½è¡£ã€å¥½ãã§ã™ã­ï¼Ÿ":"ã§ã¯ã€ç´ é¡”ã§ã€‚"); });
  document.getElementById('btn-smoke').addEventListener('click', ()=>{ state.smoke=!state.smoke; sync(); setBubble(state.smoke?"ä¸€æœ¬ã ã‘ã€‚ã™ãã«æˆ»ã‚Šã¾ã™ã€‚":"ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã‚„ã‚ã¦ãŠãã¾ã—ã‚‡ã†ã€‚"); });
  document.getElementById('btn-clear').addEventListener('click', ()=>{
    Object.values(K.img).forEach(k=>localStorage.removeItem(k));
    imgBase.removeAttribute('src'); imgCoat.removeAttribute('src'); imgSmile.removeAttribute('src'); imgSmoke.removeAttribute('src');
    setBubble("ç”»åƒã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚å†åº¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚"); updateDiag();
  });
})();
</script>
</body>
</html>
